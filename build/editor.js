(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var a in t)e.o(t,a)&&!e.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:t[a]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.plugins,t=window.wp.editPost,a=window.wp.components,o=window.wp.element,s=window.wp.data,i=window.wp.apiFetch;var l=e.n(i);const r=window.ReactJSXRuntime,c=window.wpLanguagesData||{},u=c.languages||{},d=c.allCpt||[];console.log("WP Languages Editor: Data loaded",{languages:u,allCpt:d,editorData:c}),c.nonce&&!window.wpLanguagesNonceApplied&&(l().use(l().createNonceMiddleware(c.nonce)),window.wpLanguagesNonceApplied=!0),(0,n.registerPlugin)("wp-languages-connections",{render:()=>{const e=(0,s.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),n=(0,s.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),i=(0,o.useMemo)(()=>(e=>{if(!e||!Array.isArray(d))return null;let n=null,t=null;if(d.some(a=>!!a&&Object.keys(a).some(o=>a[o]===e&&(n=a,t=o,!0))),!n||!t)return null;const a=Object.keys(n).filter(e=>e!==t);return{group:n,sourceLang:t,otherLangs:a}})(n),[n]),[c,g]=(0,o.useState)(""),[p,m]=(0,o.useState)({}),[w,h]=(0,o.useState)(!1),[S,b]=(0,o.useState)([]),[f,x]=(0,o.useState)(!1),[j,v]=(0,o.useState)(!1),[P,C]=(0,o.useState)(null);(0,o.useEffect)(()=>{if(!i)return g(""),m({}),void b([]);i.otherLangs.includes(c)||g(i.otherLangs.length?i.otherLangs[0]:"")},[i]);const y=(0,o.useCallback)(()=>{e&&i?(h(!0),C(null),l()({path:`/wp-languages/v1/connections?post_id=${e}`}).then(e=>{m(e?.connections||{})}).catch(e=>{C(e?.message||e?.data?.message||"Error al cargar las conexiones.")}).finally(()=>{h(!1)})):m({})},[e,i]);(0,o.useEffect)(()=>{e&&i&&y()},[e,i,y]);const L=(0,o.useCallback)(n=>{e&&i&&n?(x(!0),C(null),l()({path:`/wp-languages/v1/available?post_id=${e}&target_lang=${n}`}).then(e=>{b(e?.posts||[])}).catch(e=>{C(e?.message||e?.data?.message||"Error al cargar los posts disponibles.")}).finally(()=>{x(!1)})):b([])},[e,i]);if((0,o.useEffect)(()=>{c?L(c):b([])},[c,L]),!i)return(0,r.jsx)(t.PluginDocumentSettingPanel,{name:"wp-languages-connections",title:"Conexiones de idiomas",children:(0,r.jsx)("p",{children:"Este tipo de contenido no admite conexiones entre idiomas."})});if(!i.otherLangs.length)return(0,r.jsx)(t.PluginDocumentSettingPanel,{name:"wp-languages-connections",title:"Conexiones de idiomas",children:(0,r.jsx)("p",{children:"No hay otros idiomas configurados para este tipo de contenido."})});const E=i.otherLangs.map(e=>({value:e,label:u[e]||e})),_=[{value:"",label:f?"Cargando opciones…":"— Sin conexión —"},...S.map(e=>({value:String(e.id),label:e.title?`${e.title}${e.status&&"publish"!==e.status?` (${e.status})`:""}`:`(ID ${e.id})`}))],D=c&&p[c]?.id?String(p[c].id):"";return(0,r.jsxs)(t.PluginDocumentSettingPanel,{name:"wp-languages-connections",title:"Conexiones de idiomas",children:[P&&(0,r.jsx)(a.Notice,{status:"error",onRemove:()=>C(null),isDismissible:!0,children:P}),(0,r.jsx)(a.SelectControl,{label:"Idioma destino",value:c,onChange:e=>{g(e),b([])},options:[{value:"",label:"Selecciona un idioma"},...E]}),w&&(0,r.jsx)(a.Spinner,{}),c?f?(0,r.jsx)(a.Spinner,{}):(0,r.jsxs)(o.Fragment,{children:[(0,r.jsx)(a.SelectControl,{label:"Post conectado",value:D,onChange:n=>{if(!c||!e)return;const t=n?parseInt(n,10):0;v(!0),C(null),l()({path:"/wp-languages/v1/connect",method:"POST",data:{post_id:e,target_lang:c,target_post_id:t}}).then(e=>{m(e?.connections||{}),L(c)}).catch(e=>{C(e?.message||e?.data?.message||"Error al guardar la conexión.")}).finally(()=>{v(!1)})},options:_,help:"Solo se muestran los posts que aún no están emparejados.",disabled:j}),!S.length&&!D&&(0,r.jsx)("p",{children:"No hay posts disponibles para este idioma."})]}):(0,r.jsx)("p",{children:"Elige primero un idioma para ver los posts disponibles."})]})},icon:"translation"}),console.log("WP Languages Editor: Plugin registered")})();